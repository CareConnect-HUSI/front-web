<div class="cronograma-container">
    <h3 class="text-center">Cronograma de Enfermeras</h3>

    <!-- Selector de Turno y Fecha/Hora Actual -->
    <div class="selector-container">
        <label for="turno">Seleccionar Turno:</label>
        <select id="turno" [(ngModel)]="turnoSeleccionado" (change)="cambiarTurno()">
            <option value="mañana">Mañana (07:00 - 13:00)</option>
            <option value="tarde">Tarde (13:00 - 19:00)</option>
            <option value="noche">Noche (19:00 - 07:00)</option>
        </select>
        <span class="fecha-hora">{{ fechaHoraActual }}</span>
    </div>
    
    <div class="table-wrapper">
        <table class="cronograma">
            <thead>
                <tr>
                    <th>Enfermera</th>
                    <th *ngFor="let hora of horasVisibles">{{ hora }}</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let enfermera of enfermeras; trackBy: trackByEnfermera">
                    <td>{{ enfermera.nombre }}</td>
                    <ng-container *ngFor="let hora of horasVisibles; trackBy: trackByHora">
                        <td [attr.colspan]="getColspan(asignaciones[enfermera.nombre][hora])"
                            [attr.data-hora]="hora" 
                            [attr.data-enfermera]="enfermera.nombre" 
                            (dragover)="permitirSoltar($event)" 
                            (drop)="soltarPaciente($event, enfermera, hora)">
                            
                            <div *ngIf="asignaciones[enfermera.nombre]?.[hora]" 
                                 class="paciente" 
                                 [draggable]="modoEdicion" 
                                 (dragstart)="arrastrarPaciente($event, enfermera, hora)"
                                 (mouseenter)="mostrarInfoPaciente(asignaciones[enfermera.nombre][hora])"
                                 (mouseleave)="ocultarInfoPaciente()">
                                {{ asignaciones[enfermera.nombre][hora].nombre }}
                                ({{ asignaciones[enfermera.nombre][hora].duracion }} min)
                                <button *ngIf="modoEdicion" (click)="eliminarPaciente(enfermera, hora)" class="eliminar-paciente">-</button>
                            </div>
                        </td>
                    </ng-container>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- Botones Modificar - Descargar (solo en modo de solo lectura) -->
    <div *ngIf="!modoEdicion" class="botones-acciones">
        <button (click)="modificarCronograma()">Modificar</button>
        <button (click)="descargarCronograma()">Descargar</button>
    </div>

    <!-- Botones de edición (solo en modo de edición) -->
    <div *ngIf="modoEdicion" class="botones-acciones">
        <button (click)="guardarCambios()">Guardar Modificación</button>
    </div>
    
    <!-- Información del Paciente -->
    <div *ngIf="pacienteHover" class="info-paciente">
        <p><strong>Nombre:</strong> {{ pacienteHover.nombre }}</p>
        <p><strong>Dirección:</strong> {{ pacienteHover.direccion }}</p>
        <p><strong>Teléfono:</strong> {{ pacienteHover.telefono }}</p>
    </div>

    <!-- Agregar Urgencia -->
    <div *ngIf="modoEdicion" class="panel-urgencias">
        
            <h4>Agregar Urgencia</h4>
            <div class="form-grid">
            <input type="text" placeholder="Documento de identificacion" [(ngModel)]="nuevoPaciente.documento">
            <input type="text" placeholder="Nombre del paciente" [(ngModel)]="nuevoPaciente.nombre">
            <input type="text" placeholder="Dirección" [(ngModel)]="nuevoPaciente.direccion">
            <input type="text" placeholder="Teléfono" [(ngModel)]="nuevoPaciente.telefono">

            <label>Hora de Atención:</label>
            <input type="time" [(ngModel)]="nuevoPaciente.horaAtencion">

            <label>Medicamento:</label>
            <select [(ngModel)]="nuevoPaciente.medicamento">
                <option *ngFor="let medicamento of medicamentos" [value]="medicamento">{{ medicamento }}</option>
            </select>

            <label>Procedimiento:</label>
            <select [(ngModel)]="nuevoPaciente.procedimiento">
                <option *ngFor="let procedimiento of procedimientos" [value]="procedimiento">{{ procedimiento }}</option>
            </select>

            <label>Duración (minutos):</label>
            <input type="number" min="30" step="30" [(ngModel)]="nuevoPaciente.duracion">
        </div>
            <button (click)="agregarUrgencia()">Agregar Urgencia</button>
            <button (click)="cerrarPanelUrgencia()">Cerrar</button>
        
    </div>
</div>